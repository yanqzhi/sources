外国送金依頼
(SAP R/3 Release 4.6Cから)
グローバリゼーションサービス / SAP AG
銀行と企業とのデータ送受信
日本
国内仕入れ先
海外
会社コード
全銀手順
何手順 ??
全銀手順
国際標準
SWIFT
全銀手順
(国内銀行)
国外仕入先
(国内銀行)
(国外銀行)
日本国内でのデータ交換は全銀手順で行われます。
外資系銀行や全銀協に加盟していない銀行の場合、独自の手順があると思われます。
国内銀行と国外銀行との間のデータ交換は、ほとんどは国際標準(SWIFT)で行われています。
© 2012 SAP AG. All rights reserved.
2
銀行と企業とのデータ送受信
国際標準
SWIFT MT100 (支払)
SWIFT MT940 (入出金)
日本: ‘全銀協フォーマット’
総合振込 (Rel.2.0から標準)
給与振込(民間) (Rel.2.0から標準)
振込入金通知 (Rel.3.0から標準)
入出金取引明細 (Rel.3.0から標準)
外国送金依頼(Rel.4.6から標準)
国際標準(SWIFT)のMT100とMT940に対しては
SAPに標準プログラムがあり、多くのSAP拡張が用意
されています。
全銀協では適用業務用に目的に応じたレコードフォー
マットを約30種類制定しています。
各レコードフォーマットは、レコード長、レイアウト、レコード
の並び順、編集方法が異なり、それに応じたプログラム
が必要となります。
RFFOJP_T : 総合振込、給与振込(民間)
RFEBJP00 : 振込入金通知、入出金取引明細
RFFOJP_L : 外国送金依頼
RFFOM100: SWIFT形式 MT100
外国為替取引明細(会計性): 仕向送金取組 (Rel 3.1Hからアドオンのみ。SAPジャパ
ン有償コンサルティングサービス)
* 日本で日本の銀行とデータ送受信するときは全銀手順となります。
• 各全銀協フォーマットはレコード長、レイアウト、レコードの並び順、編集方法がそれぞれ異なります。
目的に応じたレコードフォーマット(適用業務用に約30種類)
© 2012 SAP AG. All rights reserved.
3
外国送金依頼(全銀手順)へのSAPの対応
外国送金依頼

全銀協フォーマット: 外国送金依頼レコード

外国送金依頼書(日本語), 支払明細通知書(受取人言語): SAPスクリプト

相場区分
 全銀手順 – SPOT, CONT, NOEX, 円建, 円相当外貨
 全銀手順にない外貨相当別外貨送金(外国送金依頼書のみ出力)
送金種類区分, 支払区分, 支払手数料支払区分(指示キー), 送金目的 (国際収支項目番号)を
システムパラメータ設定可能


自動支払で採番した支払依頼番号を依頼人整理番号として銀行へ通知

会計処理内訳: オープンFIを使って、1送金データを3つまで分割指示可能
送金結果取込
全銀協フォーマット: 外国為替取引明細(会計性)-仕向送金取組レコードをファームバンキングシス
テム等で一覧作成(SAPシステム外)

送金金額を支払依頼番号で消込: 確定した為替レートによる実現為替差損益計上(FI銀行支払
等での消込処理)

送金手数料計上(FI伝票登録)
上記の自動化機能をSAPジャパンでアドオン開発、有償コンサルティングサービスで提供
© 2012 SAP AG. All rights reserved.
4
SAPによる外国送金 (全銀手順)
1月3日
1
FB01: 買掛金/未払金計上 / MIRO: ロジスティクス請求書照合
債務
未消込明細データ
Invoice
受取人
(仕入先)
2
FB02: 財務部門担当者による伝票変更
外国送金追加情報入力
© 2012 SAP AG. All rights reserved.
5
SAPによる外国送金 (全銀手順)
2月3日
* 支払依頼番号で、
未消込明細の消込
マニュアル銀行支払、又は
送金結果取込プログラム
(アドオン)
債務
未消込明細データ
3
自動支払
プログラム
5
仕向送金取組
全銀協フォー
マット
DMEファイル
受取人
(仕入先)
* 支払依頼番号を採番
(明細は未消込のまま)
支払データ
(REGU*)
4
外国送金依頼
プログラム(標準)
外国送金依頼
プログラム(アドオン)
全銀協フォー
マット
DMEファイル
外国送金依
頼書
仕向銀行
(取引銀行)
被仕向銀行
(仕入先銀行)
支払明細通
知書
郵送/FAX
© 2012 SAP AG. All rights reserved.
6
SAPによる外国送金 (全銀手順)
3月3日
送金の元データ(債務: 買掛金や未払金)が転記された後の流れは以下のとおりです。
- 始めに自動支払処理(F110)で債務(買掛金や未払金)の未払データ(未消込明細データ)から支払データを作成
します。
- 次に外国送金依頼プログラム(RFFOJP_L)で外国送金依頼データを作成します (自動支払処理の印刷プログ
ラムとして実行)。
外国送金依頼データ: 全銀協フォーマット-外国送金依頼レコードフォーマットでのDMEファイル
外国送金依頼書: 送金依頼銀行に紙で依頼するとき、又は保存用として出力
(私製の外国送金依頼書になるため事前に送金依頼銀行の承認が必要)
支払明細通知書: 受取人(仕入先)への支払明細通知書(仕入先マスタの言語で出力可能)
標準プログラムを改造したアドオンプログラムをSAPジャパンの有償コンサルティングサービスで提供
- 送金依頼銀行(仕向銀行)に外国送金を依頼します(DMEファイルの伝送、又は外国送金依頼書のFAX/郵送/
持参)
- 受取人(仕入先)に支払明細通知書をFAX又は郵送します。
- 仕向銀行が被仕向銀行に送金し、その時の確定レート、手数料を依頼人に返します。
仕向銀行からの確定レートで債務(買掛金や未払金)を消し込み(為替差損益発生)、手数料を計上します。
(アドオンプログラムとして送金結果取込プログラムが開発され、SAPジャパンの有償コンサルティングサービスによ
り提供されています。)
© 2012 SAP AG. All rights reserved.
7
目次
1. パラメータ設定
2. 仕入先マスタデータ定義
3. 会計伝票
4. 自動支払処理
5. 拡張RFFOX230
Appendix A 全銀行レコードレイアウト
Appendix B 支払プログラム処理概要
過去にSAPジャパン株式会社からコンサルティングサービスとして提供させて頂いておりましたアドオンプログラムは終
売となりました。
© 2012 SAP AG. All rights reserved.
8
1. パラメータ設定
1. パラメータ設定
1.1 トランザクションイベントでの汎用モジュール定義
1.2 銀行手数料負担コード(指示キー )(送金種類区分, 支払区分, 相場区分)
1.3 国別支払方法
1.4 会社コード別支払方法 – 外国送金依頼書書式
1.5 支払会社コード – 支払明細通知書書式
1.6 銀行選択(仕向銀行)
1.7 取引銀行マスタ
1.8 中央銀行コード – 送金目的(国際収支項目番号)
© 2012 SAP AG. All rights reserved.
10
1.1 トランザクションイベントでの汎用モジュール定義
IMG: 財務会計-> 財務会計共通設定 -> ツール -> カスタマ拡張 -> 取引イベント -> 設定 -> P/S モジュール ->
SAPアプリケーション
ひとつの伝票(送金元データ)に対して異なる相場区分が適用され
る場合、相場区分をこの伝票(送金元データ)に対して分ける必要
があります。異なる相場区分を設定するために、2つの汎用モジュ
ールが使われています。3.3会計処理内訳追加情報入力－送金
元データを参照して下さい。
外国送金用のオープンFIのイベント
 Rel. 4.6で日本の外国送金用にイベントが追加されました。
 イベント1012 : 伝票変更時に、‘追加詳細’ ボタンがクリックされたときに起動します。
 イベント1013 : 伝票変更時に、参照キー3に‘*’ が入力されたとき、仕入先マスタの
国コードが外国、又は伝票通貨コードが外貨のときに起動します。
© 2012 SAP AG. All rights reserved.
11
1.2 銀行手数料負担コード(指示キー)
送金種類区分, 支払区分, 相場区分
IMG: 財務会計 -> 債権管理および債務管理 -> 会計トランザクション -> 銀行支払 -> 自動銀行支払 -> 支払
媒体 -> DME -> 定義:支払処理の銀行手数料
** 銀行手数料負担コード(指示キー)は、日本用の外国送金依頼のDMEファイルで使われます。
銀行手数料負担コード(指示キー)は、4つの項目からなります。これらの項目には、債務
(買掛金/未払金)の転記時に値が設定されます。但し日本では、3つの項目だけ使用し
ます。
一つ目は、送金種類区分です。電信送金(T.T)か、郵便送金(M.T)か、小切手送金か
を銀行に連絡するものです。
二つ目は、支払区分です。通知払いか、口座振込かを銀行に連絡するものです。
三つ目は、相場区分です。直物レートか、予約レートか、外貨建送金か、円建送金かを
銀行に連絡するものです。
最大4つの項目を
使うことができま
すが、日本では3
つだけ使います。
許容されている送金種類区分, 支払区分、相場区分を次の画面で定義する必要があり
ます。
例) 3つ目の項目(相場区分)については6種類の値が許容されています。直物レートで
支払を行いたい場合は、3つ目の項目(相場区分)は1を選択する必要があります。
注意: 次頁の画面にある項目‘Instrtn’ の値を、FI伝票転記時に入力値として使いま
すが、項目 ‘コード言語’ の値がDMEファイルにセットされます。銀行手数料負担コード
(指示キー) については、以降の頁を参照して下さい。
© 2012 SAP AG. All rights reserved.
12
1.2 銀行手数料負担コード(指示キー)
送金種類区分, 支払区分, 相場区分
コード言語: 各銀行独自の
コード値に変換するために
使用(DMEファイル用)
コードテキスト: 外国送
金依頼書に各テキスト
として使用
設定可能な送金種類区分
項目
1 : 送金種類区分
2 : 支払区分
設定可能な支払区分
3 : 相場区分
設定可能な相場区分
© 2012 SAP AG. All rights reserved.
13
1.2 銀行手数料負担コード(指示キー)
送金種類区分, 支払区分, 相場区分
全銀協フォーマットで使用可能な相場区分
 01: SPOT (直物レート)
 02: CONT (予約レート)
 03: NOEX (外貨建、外貨口座からの支払 )
 04: 円建、円口座からの支払
 05: 円貨額相当の外貨建送金(直物レート)
全銀協フォーマットで認められているのは、01から04までのため、コード言語は ’01’ とします。
例) 債務(買掛金/未払金)の通貨が円で、支払は外貨で行う(支払通貨の機能を使用)。
100円を1USドルで支払う。
 06: 外貨額相当の別外貨建送金(直物レート)
コード言語は ’01’ とします。DMEファイルは作成されません。
例) 債務(買掛金/未払金)の通貨は外貨で、支払は別の外貨で行う(支払通貨の機能を使用)。
100ルーブルを110USドルで支払う。
 07: 外貨額相当の円建送金
コード言語は ’01’ とします。DMEファイルは作成されません。SAPジャパン開発のアドオンプログラム
のみ対応。
例)債務(買掛金/未払金)の通貨は外貨で、支払は円で行う(支払通貨の機能を使用)
1USドルを100円で支払う。
© 2012 SAP AG. All rights reserved.
14
1.2 銀行手数料負担コード(指示キー)
支払手数料支払区分
銀行手数料負担コード(指示キー)は3つの情報と、支払
手数料支払区分を持っています。
1) ‘送金種類区分’
2) ’支払区分’
銀行手数料負担コード(指示キー)
銀行手数料負担コード(指示キー)を仕入
先マスタの銀行詳細に設定します。
3) ’相場区分’
読み方の例:
支払方法Eの銀行手数料負担コード(指示キー)’01’
-
送金種類区分’1’ :電信送金(T.T)
支払区分’2’ : 口座振込
相場区分’1’ : 直物レート
銀行手数料は送金受取人負担
支払方法毎に、銀行手数料負担コード(指示キー)を定義することができます。項目‘CA’ は支払手
数料支払区分を表します。
1 送金受取人が支払
2 送金支払人が支払
(注)手数料支払区分は、国内総合振込(支払方法T)の場合と逆です。
銀行手数料負担コード(指示キー)を仕入先マスタ、取引銀行マスタに初期値として設定します。
2.2 仕入先マスタ – 銀行詳細(被仕向銀行)を参照して下さい。
© 2012 SAP AG. All rights reserved.
15
1.2 銀行手数料負担コード(指示キー)
相場区分
このマトリックスは、FORM accounting_info_fields_fuellen /
include RFFORIJ5 / RFFOJP_Lで、どのように相場区分が決められて
いるかを説明しています。
銀行手数料負担コード(指示
キー)は、デフォルト値として、仕
入先マスタ、取引銀行マスタに
設定します。
(Case No)
-1
-2
-3
-4
-5
-6
-7
請求書通貨 = JPY
(dta_pswsl)
Yes
Yes
Yes
Yes
Yes
Yes
Yes
支払通貨 = JPY
(dta_waers)
Yes
Yes
Yes
No
No
No
No
銀行口座通貨 =
JPY
(up_twaers)
Yes
Yes
No
Yes
Yes
No
No
予約番号 = 入力なし
Yes
No
Yes
No
Yes
No
相場区分
(up_exchange)
4
Error
05→01
SPOT
Error
Error
Error
© 2012 SAP AG. All rights reserved.
Error
16
1.2 銀行手数料負担コード(指示キー)
相場区分
（Case No)
-8
-9
-10
-11
-12
-13
-14
-15
-16
-17
-18
請求書通貨 =JPY
No
No
No
No
No
No
No
No
No
No
No
支払通貨 = JPY
Yes
Yes
Yes
No
No
No
No
No
No
No
No
請求書通貨
#NAME?
(No)
(No)
(No)
Yes
Yes
Yes
Yes
Yes
No
No
No
口座通貨 = JPY
Yes
Yes
No
Yes
Yes
No
No
No
Yes
Yes
No
請求書通貨
#NAME?
(No)
(No)
(No)
(No)
Yes
Yes
No
Yes
支払通貨
#NAME?
予約番号 = 入力なし
Yes
No
相場区分
7
→
1
Error
© 2012 SAP AG. All rights reserved.
Error
Yes
NO
Yes
No
1
SPOT
2
CONT
3
NOEX
Error
Error
Yes
No
Yes
6
→
1
Error
Error
17
1.2 銀行手数料負担コード(指示キー)
相場区分
（Case No)
-19
-20
請求書通貨 = JPY
No
No
支払通貨 = JPY
No
No
請求書通貨
#NAME?
No
No
口座通貨
#NAME?
No
No
請求書通貨
#NAME?
支払通貨
#NAME?
Yes
予約番号 = 入力なし
No
相場区分
Error
© 2012 SAP AG. All rights reserved.
No
Error
18
1.3 国別支払方法
IMG: 財務会計 -> 債権管理および債務管理 -> 会計トランザクション -> 銀行支払 -> 自動銀行支払 -> 支払プ
ログラム用の支払方法/銀行選択 -> 設定:支払取引の国別支払方法
支払プログラムシステム設定: 国別支払方
法
印刷プログラム名 : RFFOJP_L
このフラグがセットされていると、自動支払
処理実行時に支払伝票を生成せずに、支
払依頼を生成します。
外国送金の場合、FI 伝票転記ではなく、
支払依頼を生成します。
© 2012 SAP AG. All rights reserved.
支払依頼生成のみ:
自動支払処理では、債務(買掛金/未払金)
を消込せずに、支払依頼番号を採番します。
銀行から確定レートが返ってきたとき、支払
依頼番号で消込をし、為替差損益を計上し
ます。
支払依頼番号が割り当てられている未消
込明細は、支払依頼番号による選択での
み消込可能です。他の項目による選択での
消込、他の自動支払処理の選択対象には
なりません。
19
1.3 国別支払方法
日本では、RFFOJP_L を使って、外国送金用のDME
ファイルを生成します。PMWを使いたい場合は、支払媒
体書式を開発する必要があります。
© 2012 SAP AG. All rights reserved.
20
1.4 会社コード別支払方法 - 外国送金依頼書書式
IMG: 財務会計-> 債権管理および債務管理 -> 会計トランザクション -> 銀行支払 -> 自動銀行支払 -> 支払プ
ログラム用の支払方法/銀行選択 -> 設定:支払取引の会社コード別支払方法
外国送金依頼書用の書式を指定します。
4.4外国送金依頼書と支払明細通知書
を参照して下さい。
印刷プログラムRFFOJP_L実行時に、DMEフ
ァイルもしくは外国送金依頼書のどちらかを指定
することができます。
© 2012 SAP AG. All rights reserved.
21
1.5 支払会社コード – 支払明細通知書書式
IMG: 財務会計-> 債権管理および債務管理 -> 会計トランザクション -> 銀行支払 -> 自動銀行支払 -> 支払
プログラム用の支払方法/銀行選択 -> 設定:支払取引の支払会社コード
支払明細通知書の書式を指定します。
4.4外国送金依頼書と支払明細通知書
を参照して下さい。
© 2012 SAP AG. All rights reserved.
22
1.6 銀行選択(仕向銀行)
IMG: 財務会計-> 債権管理および債務管理 -> 会計トランザクション -> 銀行支払 -> 自動銀行支払 -> 支払プ
ログラム用の支払方法/銀行選択 -> 設定:支払取引に使用する銀行定義
© 2012 SAP AG. All rights reserved.
23
1.7 取引銀行マスタ
IMG: 財務会計-> 銀行関連会計 -> 銀行口座 -> 定義:取引銀行
取引銀行マスタ:
DMEデータ
取引銀行から指定された
10桁の外国送金用送金
依頼人コードで、DMEファ
イル生成時に必要。
銀行手数料負担コード(指
示キー)。‘送金種類区分’,
‘支払区分’,’ 相場区分’ の
初期値。仕入先マスタでの
設定よりも優位。
© 2012 SAP AG. All rights reserved.
得意先コード(T012-DTKID): 取引
銀行が採番した10桁のコードで、外国
送金依頼プログラムでは、送金依頼人
コードとして使用します。
(国内送金では、会社コード(T012DTFIN))を送金依頼人コードとして使
用します。)
銀行手数料負担コード(指示キー): 銀
行手数料の負担区分コード(送金種類
区分, 支払区分, 相場区分, 支払手
数料支払区分)の初期値として使われ
ます。
24
1.8 中央銀行コード－送金目的(国際収支項目番号)
IMG: 財務会計-> 債権管理および債務管理 -> 会計トランザクション -> 入金請求書/クレジットメモ -> 定義:国
外取引規制のSCBフラグ
このコードを債務明細
に入力します。
パラメータ設定:
中央銀行コード
送金目的は4バイトです。
2つの項目を使って表します。
1バイト目は、レポートレコード用伝票
タイプに設定し、残りの3バイトはサー
ビス明細別フラグに設定します。
この例では、‘010’です。
外国送金依頼書用テキスト
送金目的として、国際収支項目番号(4桁の数
字)を設定します。
レポートレコード用伝票タイプ: 国際収支項
目番号の上1桁
サービス明細別フラグ:
国際収支項目番号の下3桁
支払理由1行目:
外国送金依頼書にテキスト表示
支払理由2行目:
DMEファイルに送金目的テキストとして使
用(半角カタカナ)
DMEファイル用テキスト
http://www.boj.or.jp/z/tame/regtlist.pdf
(日本語のみ)
© 2012 SAP AG. All rights reserved.
25
2. 仕入先マスタデータ定義
2 仕入先マスタデータ定義
2.1 仕入先マスタ – 住所
2.2 仕入先マスタ – 銀行詳細(被仕向銀行)
2.3 仕入先マスタ – 支払処理
© 2012 SAP AG. All rights reserved.
27
2.1 仕入先マスタ – 住所
仕入先マスタ: 住所
国コードで指定のアドレスレイア
ウトキーにより住所を編集
DMEファイルの受取人住所に
なります。
名称: 受取人名
住所: 国コードで指定のアドレスレイアウトキーによ
り住所を編集します(国によってはレイアウトが異な
ります。)。また国別印刷フラグをONにします。
国名: 英語の国コード名称を使用します。
言語: 支払明細通知書のテキスト言語として使用
可能
受取人言語で支払明細
通知書を印刷することが
可能
© 2012 SAP AG. All rights reserved.
28
2.2 仕入先マスタ – 銀行詳細(被仕向銀行)
仕入先マスタ: 銀行詳細
受取人の銀行国コード、銀行コード(被仕向銀行。銀行マスタにあらかじめ登録が必要)、口座番号、一部の国では
銀行管理キー、参照詳細も必要となります。
銀行手数料負担コード(指示キー) : 銀行手数料負担コード(指示キー)の初期値として使用します。ないときは、取引
銀行マスタに設定された値を使用します。
受取人(仕入先)の銀行情報:
銀行コード
口座番号
口座名義人
預金種別
銀行手数料負担コード(指示キー) :
‘送金種類区分’ ,’支払区分’, ’ 相場区分’, 手数料負担区分の初
期値として使用します。
トランザクションOB47で銀行手数料負担コード(指示キー)を定義
します。銀行手数料負担コード(指示キー )を参照して下さい。
この情報は、印刷プログラムによって。支払媒体に
渡されます。例えば、日本では、預金種別について、
以下のように使います。
01 普通
02 当座
04 貯蓄
09 その他
© 2012 SAP AG. All rights reserved.
29
2.3 仕入先マスタ – 支払処理
仕入先マスタ : 支払処理
支払方法: 外国送金用の支払方法を指定します。
グループキー : グループキーの値によって、支払伝票が分割されます。
外国送金用に、標準設定では日本向けに ‘E’が出荷
されています。
テーブルREGUHのエントリの生成単位。
“中央銀行コード” がグループキーとして定義されている場合は、“中央銀行コ
ード” が異なると、テーブルREGUHのエントリが別に生成されます。
会社コード別支払方法で、“選択明細個別支払” が指定されている場合、テ
ーブルREGUHのエントリは、債務明細毎に生成されます。参照キー3(予約
番号)に入力がある外貨の支払の場合は債務明細毎に支払データを生成す
る必要があります。
© 2012 SAP AG. All rights reserved.
30
3. 会計伝票
3 会計伝票
3.1 債務(買掛金/未払金)計上－送金元データ
3.2 外国送金追加情報入力－送金元データ
3.3 会計処理内訳追加情報入力－送金元データ
© 2012 SAP AG. All rights reserved.
32
3.1 債務(買掛金/未払金)計上－送金元データ
受取人宛メッセージ：
PAYER I/2000-123456789 OF 21/01/03 ADVERTISING EXPENSES
(参照伝票番号) (請求書日付) (明細テキスト)
FI仕入先請求書入力画面の例です。
受取人宛メッセージとして、参照伝票番号、請求書日
付、明細テキストを編集します。
‘payer’: 固定文字
 参照伝票番号: 受領した請求書番号等
‘Of’: 固定文字
 請求書日付: 受取人の国の日付形式
 明細テキスト: 1文字目の’*’が外されます (’*’が
1文字目にないと明細テキストが使われません)
© 2012 SAP AG. All rights reserved.
33
3.2 外国送金追加情報入力－送金元データ
財務部門が必要に応じて伝票変更で追加情報を入
力します。
支払通貨:
伝票通貨以外での送金(円相当外貨送金、外貨
相当別外貨送金: 全銀手順にはない)のとき
指示キー: 送金種類区分、
支払区分、相場区分
マスタで設定した初期値を変更す
るとき指定
銀行手数料負担コード:
仕入先マスタ/取引銀行マスタでの初期値を変更
するとき
指示キー1
指示キー2
指示キー3
送金目的 -> 国際収支項目番号
1.8 中央銀行コードを参照
: 送金種類区分
: 支払区分
: 相場区分
参照キー3:
為替予約を使用するときの予約番号、又は会計
処理内訳を分割(3つまで)するとき ‘*’ を入力
相場区分や予約番号によって会計処理内訳を分割したい場合、参照キー3に * を入力すると、日本の外
国送金用の会計処理内訳追加情報画面に遷移します。 これは標準処理ではありません。この画面を使う
場合は、イベントで2つの汎用モジュールを定義する必要があります。1.1 トランザクションイベントでの汎用
モジュール定義を参照して下さい。
© 2012 SAP AG. All rights reserved.
34
3.3 会計処理内訳追加情報入力－送金元データ
前提条件:
1
伝票変更であること
2
取引銀行を特定していること
3
明細個別支払であること
4
外貨を円相当額で送金する場合には不
可能(全銀協指定)
明細の追加詳細入力:
参照キー3 に ‘*’ と入力した場合のみ、日本の外国
送金用の追加情報入力画面に遷移します。
予約番号
ER
Category : 相場区分
金額 : 3つまでの合計金額が伝票明細金額に一致
契約番号 : 予約番号を入力
口座ID : 取引銀行を入力
注意
この情報は、FSCM-TRMの為替予約のデータと
はリンクしていません。
© 2012 SAP AG. All rights reserved.
相場区分
相場区分と予約番号によって、金額を分割する
ことができます。
35
4. 自動支払処理
4 自動支払処理
4.1 支払処理(F110)パラメータ入力
4.2 印刷プログラム(RFFOJP_L)
4.3 DMEファイル
4.4 外国送金依頼書と支払明細通知書
4.5 支払プログラムパラメータ設定 会社コード別支払方法 - 外国送金依頼書
(SAPスクリプト)の指定
4.6 支払プログラムパラメータ設定 支払会社コード - 支払明細通知書(SAPスクリ
プト)の指定
4.7 債務(買掛金/未払金)消込
© 2012 SAP AG. All rights reserved.
37
4.1 支払処理(F110)パラメータ入力
外国送金の場合、支払方法として ‘E’
を選択します。
© 2012 SAP AG. All rights reserved.
38
4.2 印刷プログラム(RFFOJP_L)
自動支払処理の印刷プログラムとしてバリアント指定
外国送金依頼プログラム(RFFOJP_L)のパラメータ入力画
面です。
バリアントとして登録し、自動支払処理の印刷プログラムで指
定します。
提案での実行が可能:
但しチェック用としての使用は不向き
印刷管理
送金依頼書:
外国送金依頼書 (SAPスクリプト, 日本語)
データ媒体:
全銀協の外国送金依頼レコード(DME)
支払明細通知書:
支払明細通知書 (SAPスクリプト, 受取人(仕入先)言語指定可能)
出力管理
改行区分:
CR/LFの指定可能
受取人言語でのテキスト:
仕入先マスタの言語で支払明細通知書印刷
外国送金依頼書又はデータ媒体(DME)のどち
らか一方を選択することが可能です。
© 2012 SAP AG. All rights reserved.
39
4.3 DMEファイル
全銀協の外国送金依頼レコードのフォーマットで作成
送金依頼銀行へは、DME管理でデータダウンロードを行い、SAPシステム外の銀行へのデータ送信システムで伝
送します。
データのコード変換は必要に応じて、SAPシステム外で行います(EBCDIC, JIS)。
© 2012 SAP AG. All rights reserved.
40
4.4 外国送金依頼書と支払明細通知書
‘外国送金依頼書’の出力、‘支払明細通知書’の出力が可能です。使用する書式を
自動支払処理のIMGで指定します。
© 2012 SAP AG. All rights reserved.
41
4.5 支払プログラムパラメータ設定
会社コード別支払方法－外国送金依頼書(SAPスクリプト)の指定
支払プログラムパラメータ設定 : 会社コード別支払方法
入出金データ転送媒体書式 : 外国送金依頼書用のSAPスクリプトの名称を入力します。標準では
F110_JP_TRANS_L が出荷されています。
書式上の振出人 : DMEファイルの送金依頼人名として使われます。
© 2012 SAP AG. All rights reserved.
42
4.5 支払プログラムパラメータ設定
会社コード別支払方法－外国送金依頼書(SAPスクリプト)の指定
外国送金依頼書
SAPスクリプトで日本語のテキストを使用します。
私製のフォームとなるため、事前に送金依頼銀行の了解が必要です。
依頼人整理番号には、自動支払
処理で採番した支払依頼番号が
セットされます。
© 2012 SAP AG. All rights reserved.
43
4.6 支払プログラムパラメータ設定
支払会社コード – 支払明細通知書(SAPスクリプト)の指定
支払プログラムパラメータ設定: 支払会社コード
支払明細通知書用書式: 支払明細通知書用のSAPスクリプトの名称を入力します。
(国内総合振込で使用するものと同じですが、テキストの言語を支払方法毎に変えて定義します。)
標準では、F110_JP_AVIS に対して英語のテキストのものが出荷されています。
© 2012 SAP AG. All rights reserved.
44
4.6 支払プログラムパラメータ設定
支払会社コード – 支払明細通知書(SAPスクリプト)の指定
支払明細通知書
SAPスクリプトでログオン言語、又は受取人(仕入先)言語のテキストを使用します。
(実際にはプリンタで印刷可能な言語のみ)
© 2012 SAP AG. All rights reserved.
45
4.7 債務(買掛金/未払金)消込
債務(買掛金/未払金)を確定レートで消し込みます。
支払依頼番号: 外国送金依頼時には依頼人整理番号として送金依頼銀行に出しています。支払依頼番号を採番した債務(買
掛金/未払金)の消込は、支払依頼番号でのみ可能となります。他の項目では選択できません。また支払依頼番号を採番した債
務(買掛金/未払金)は、他の自動支払処理では選択対象外となります。
© 2012 SAP AG. All rights reserved.
46
5. 拡張 RFFOX230
汎用モジュール EXIT_RFFOEXIT_230
日本の外国送金依頼レコード2から6のデータ編集用
ユーザExitを使って、日本の外国送金依頼のデータを編集することができます。
構造 DTAMJP に定義されている項目が、編集項目です。
呼び出されるインクルードプログラム ZXFORU34 を生成して、データ編集のロジックを記述します。
ZXFORU34は汎用モジュール EXIT_RFFOEXIT_230 に含まれています。
トランザクションCMOD (SAP拡張プロジェクト管理)から、ユーザExitを登録します。
1. プロジェクトを登録します。
2. 拡張 RFFOX230 を割り当てます。
3. コンポーネントボタンを押すと、汎用モジュール EXIT_RFFOEXIT_230 が割り当たっていることがわかり
ます。EXIT_RFFOEXIT_230 をダブルクリックして汎用モジュールEXIT_RFFOEXIT_230 の中に入
り、“ZXFORU34”をダブルクリックしてこれを生成し、有効化します。生成されていないと警告メッセージが
表示されますが、戻らずに進んで、まず、インクルードZXFORU34を生成して下さい。
4. 受け渡されてきたデータを編集するロジックをZXFORU34に実装します。
5. インクルードZXFORU34, 汎用モジュールEXIT_RFFOEXIT_230, プロジェクトを有効化します。
© 2012 SAP AG. All rights reserved.
48
汎用モジュール EXIT_RFFOEXIT_230
日本の外国送金依頼レコード2から6のデータ編集用
データレコードを埋め込んだ後で、ユーザ Exitが呼び出されます。
編集項目は構造DTAMJPに定義されている項目です。
受け渡されてきた値を編集するロジックを、インクルードプロ
グラム ZXFORU34 に実装します。
編集項目は拡張されています。SAPノート1248423, SAPノー
ト1602174, SAPノート1884202をご参照下さい。
© 2012 SAP AG. All rights reserved.
49
汎用モジュール EXIT_RFFOEXIT_230
(例)送金指図内訳のデータを構造DTAJPZを使って編集してみる
支払処理実行で生成された支払データ
支払媒体データ(DMEデータ)
REGUH
REGUP
RFFOJP_Lを実行すると、
このExitに実装したロジッ
クを通る。
ユーザExitにロジックを実装。
(ご要件にあったロジックを実
装して下さい。)
© 2012 SAP AG. All rights reserved.
50
Appendix.A
全銀協レコードレイアウト
全銀協レコードレイアウト
ファイル構成およびシークエンス・フロー 1/2
© 2012 SAP AG. All rights reserved.
52
全銀協レコードレイアウト
ファイル構成およびシークエンス・フロー 2/2
© 2012 SAP AG. All rights reserved.
53
全銀協レコードレイアウト - レコード内容 1/6
© 2012 SAP AG. All rights reserved.
54
全銀協レコードレイアウト - レコード内容 2/6
© 2012 SAP AG. All rights reserved.
55
全銀協レコードレイアウト - レコード内容 3/6
© 2012 SAP AG. All rights reserved.
56
全銀協レコードレイアウト – レコード内容 4/6
© 2012 SAP AG. All rights reserved.
57
全銀協レコードレイアウト – レコード内容 5/6
注意:
銀行宛メッセージ、支払銀行、経由銀行のための専用の構造は標準では出荷されていません。
シナリオによっては、構造DTAJPZを使い、値をセットするロジックをユーザExit (拡張RFFOX230)に実装することが可能なケースもあると
思われます。
© 2012 SAP AG. All rights reserved.
58
全銀協レコードレイアウト – レコード内容 6/6
© 2012 SAP AG. All rights reserved.
59
Appendix.B
支払プログラム処理概要
支払プログラム – 処理フロー
支払処理(F110) 入力パラメータ
(SAPF110V)
カスタマイジング
(T012*/T042* ...)
利用可能額
(T042D)
マスタデータ
(KNA1/LFA2 ... BNKA)
F110 支払処理
(SAPF110S)
支払データ
(REGUH/REGUP)
提案データ
(REGUH/REGUP)
支払一覧
(RFZALI00/RFZALI10)
RFFO* 印刷プログラム
(ＤＭＥファイル生成)
支払媒体 ＤＭＥデータ
(TemSe/Filesyst.
REGUT ...)
© 2012 SAP AG. All rights reserved.
会計伝票
(BKPF/BSEG ...)
パラメータ
(REGUV/RFDT)
提案編集
(SAPF110O)
変更履歴(REGUA
REGUHH/REGUPO)
支払一覧/例外一覧
(スプール)
送金依頼書 (スプール)
支払明細通知書
(スプール)
支払概要
(スプール, ジョブログ)
支払依頼
(PYORDH, PYORDP)
